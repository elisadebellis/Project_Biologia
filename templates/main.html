<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Theme Made By www.w3schools.com -->
  <title>Upload Files</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  
  <style>
  body {
    font: 400 15px Lato, sans-serif;
    line-height: 1.8;
    color: #818181;
  }
  h2 {
    font-size: 24px;
    text-transform: uppercase;
    color: #303030;
    font-weight: 600;
    margin-bottom: 30px;
  }
  h4 {
    font-size: 19px;
    line-height: 1.375em;
    color: #303030;
    font-weight: 400;
    margin-bottom: 30px;
  }  
  .jumbotron {
    background-color: #132235;
    color: #fff;
    padding: 100px 25px;
    font-family: Montserrat, sans-serif;
  }
  .container-fluid {
    padding: 60px 50px;
  }
  .bg-grey {
    background-color: #f6f6f6;
  }
  .logo-small {
    color: #132235;
    font-size: 50px;
  }
  .logo {
    color: #132235;
    font-size: 200px;
  }
  .thumbnail {
    padding: 0 0 15px 0;
    border: none;
    border-radius: 0;
  }
  .thumbnail img {
    width: 100%;
    height: 100%;
    margin-bottom: 10px;
  }
  .carousel-control.right, .carousel-control.left {
    background-image: none;
    color: #132235;
  }
  .carousel-indicators li {
    border-color: #132235;
  }
  .carousel-indicators li.active {
    background-color: #132235;
  }
  .item h4 {
    font-size: 19px;
    line-height: 1.375em;
    font-weight: 400;
    font-style: italic;
    margin: 70px 0;
  }
  .item span {
    font-style: normal;
  }
  .panel {
    border: 1px solid #132235; 
    border-radius:0 !important;
    transition: box-shadow 0.5s;
  }
  .panel:hover {
    box-shadow: 5px 0px 40px rgba(0,0,0, .2);
  }
  .panel-footer .btn:hover {
    border: 1px solid #132235;
    background-color: #fff !important;
    color: #132235;
  }
  .panel-heading {
    color: #fff !important;
    background-color: #132235 !important;
    padding: 25px;
    border-bottom: 1px solid transparent;
    border-top-left-radius: 0px;
    border-top-right-radius: 0px;
    border-bottom-left-radius: 0px;
    border-bottom-right-radius: 0px;
  }
  .panel-footer {
    background-color: white !important;
  }
  .panel-footer h3 {
    font-size: 32px;
  }
  .panel-footer h4 {
    color: #aaa;
    font-size: 14px;
  }
  .panel-footer .btn {
    margin: 15px 0;
    background-color: #132235;
    color: #fff;
  }
  .navbar {
    margin-bottom: 0;
    background-color: #132235;
    z-index: 9999;
    border: 0;
    font-size: 12px !important;
    line-height: 1.42857143 !important;
    letter-spacing: 4px;
    border-radius: 0;
    font-family: Montserrat, sans-serif;
  }
  .navbar li a, .navbar .navbar-brand {
    color: #fff !important;
  }
  .navbar-nav li a:hover, .navbar-nav li.active a {
    color: #132235 !important;
    background-color: #fff !important;
  }
  .navbar-default .navbar-toggle {
    border-color: transparent;
    color: #fff !important;
  }
  footer .glyphicon {
    font-size: 20px;
    margin-bottom: 20px;
    color: #132235;
  }
  .slideanim {visibility:hidden;}
  .slide {
    animation-name: slide;
    -webkit-animation-name: slide;
    animation-duration: 1s;
    -webkit-animation-duration: 1s;
    visibility: visible;
  }
  .btn-file {
    position: relative;
    overflow: hidden;
}
.btn-file input[type=file] {
    position: absolute;
    top: 0;
    right: 0;
    min-width: 100%;
    min-height: 100%;
    font-size: 100px;
    text-align: right;
    filter: alpha(opacity=0);
    opacity: 0;
    outline: none;
    background: white;
    
    display: block;
}

.btn {
    color: #000000;
    
    margin: 5px;
    font-size:30px
    
}

.btn:hover{
background-color: #818181;
}

  @keyframes slide {
    0% {
      opacity: 0;
      transform: translateY(70%);
    } 
    100% {
      opacity: 1;
      transform: translateY(0%);
    }
  }
  @-webkit-keyframes slide {
    0% {
      opacity: 0;
      -webkit-transform: translateY(70%);
    } 
    100% {
      opacity: 1;
      -webkit-transform: translateY(0%);
    }
  }
  @media screen and (max-width: 768px) {
    .col-sm-4 {
      text-align: center;
      margin: 25px 0;
    }
    .btn-lg {
      width: 100%;
      margin-bottom: 35px;
    }
  }
  @media screen and (max-width: 480px) {
    .logo {
      font-size: 150px;
    }
  }
  </style>
</head>

<body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="60">

    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>                        
          </button>
          <a class="navbar-brand" href="home"><img src="{{url_for('static', filename='Schermata 2021-12-08 alle 18.57.16.png')}}" class="navbar-left" style="width:60px;"></a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#main">UPLOAD FILE</a></li>
            <li><a href="#about">ABOUT</a></li>
            <li><a href="#services">SERVICES</a></li>
            <li><a href="#contact">CONTACT</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="main" class="container-fluid text-center">
      <div class="row">
        
        <div class="col-sm-6">
          <h2 >Select your files</h2>
          <p>E' necessario che la cartella caricata (ad esempio QUINT) deve contenere le sottocartelle di ciascun esperimento (ad esempio Massed Cue). 
            In ciascuna cartella dell’esperimento saranno presenti le cartelle relative ad ogni animale (ad esempio F92). In ogni cartella relativa all’animale saranno presenti diversi file .csv (ad esempio F92_RefAtlasRegions__s001.csv).
            Tutti i file che non sono nel formato .csv non verranno letti dal programma.
            </p>
            <img src="../static/directory.jpg" style="width:50%">
        </div>


      <div class="col-sm-4" >
        <br><br><br><br>    
        <h4> Selezionare un file .zip</h4>     
      <form action="upload.html" method="post" enctype="multipart/form-data">
        <span class="btn btn-default btn-file" style="margin-left: 26%; font-size: medium;">
        Select files
        <input type="file" class="btn-lg" name="fileupload" id="fileinput" accept = ".zip" multiple directory="" webkitdirectory="" moxdirectory="" >
      </span>
      <label id="selected_filename">No file selected</label>
      <script>
        
        $('#fileinput').change(function() {
          $('#selected_filename').text($('#fileinput')[0].files[0].name);
        });
        
      </script>

      <br><br><br>
      <input type="submit" value="Upload File" name="submit" class="btn" style="font-size:large;">

        
    </form>
    <br><h4>{{text}}</h4>
  </div>

</div>


<div class="row">
  <form method="get" action="file.doc">
    <hr>
    
    <label> Scarica la cartella dei risultati </label>
    <br> <br>
    <button type="submit" class="btn btn-dark" href="{{url_for('download_file')}}" style="font-size:x-large;">Download</button>
  </form>
</div>

<hr>
<div class="row">
<label>Visualizza i tuoi file excel </label>
</div>
<br><br>
<div class="row" >
  <span class="btn btn-default btn-file" style="font-size: medium;">
    Select files
    <input type="file" id="excelfile" />  
  </span>
    <label id="selected_filename2" style="margin-right:10%;">No file selected</label>
      <script>
        
        $('#excelfile').change(function() {
          $('#selected_filename2').text($('#excelfile')[0].files[0].name);
        });
        
      </script>
  
   <input type="button" class="btn" id="viewfile" value="Export To Table" onclick="ExportToTable()" style="font-size:large;"/>  </div>
      <br />  
      <br />  
   <table id="exceltable">  
</table> 
</div>

<script src="jquery-1.10.2.min.js" type="text/javascript"></script>  
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.7.7/xlsx.core.min.js"></script>  
<script src="https://cdnjs.cloudflare.com/ajax/libs/xls/0.7.4-a/xls.core.min.js"></script>  
<script>

function ExportToTable() {  
  var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.xlsx|.xls)$/;  
  /*Checks whether the file is a valid excel file*/  
  if (regex.test($("#excelfile").val().toLowerCase())) {  
      var xlsxflag = false; /*Flag for checking whether excel is .xls format or .xlsx format*/  
      if ($("#excelfile").val().toLowerCase().indexOf(".xlsx") > 0) {  
          xlsxflag = true;  
      }  
      /*Checks whether the browser supports HTML5*/  
      if (typeof (FileReader) != "undefined") {  
          var reader = new FileReader();  
          reader.onload = function (e) {  
              var data = e.target.result;  
              /*Converts the excel data in to object*/  
              if (xlsxflag) {  
                  var workbook = XLSX.read(data, { type: 'binary' });  
              }  
              else {  
                  var workbook = XLS.read(data, { type: 'binary' });  
              }  
              /*Gets all the sheetnames of excel in to a variable*/  
              var sheet_name_list = workbook.SheetNames;  

              var cnt = 0; /*This is used for restricting the script to consider only first sheet of excel*/  
              sheet_name_list.forEach(function (y) { /*Iterate through all sheets*/  
                  /*Convert the cell value to Json*/  
                  if (xlsxflag) {  
                      var exceljson = XLSX.utils.sheet_to_json(workbook.Sheets[y]);  
                  }  
                  else {  
                      var exceljson = XLS.utils.sheet_to_row_object_array(workbook.Sheets[y]);  
                  }  
                  if (exceljson.length > 0 && cnt == 0) {  
                      BindTable(exceljson, '#exceltable');  
                      cnt++;  
                  }  
              });  
              $('#exceltable').show();  
          }  
          if (xlsxflag) {/*If excel file is .xlsx extension than creates a Array Buffer from excel*/  
              reader.readAsArrayBuffer($("#excelfile")[0].files[0]);  
          }  
          else {  
              reader.readAsBinaryString($("#excelfile")[0].files[0]);  
          }  
      }  
      else {  
          alert("Sorry! Your browser does not support HTML5!");  
      }  
  }  
  else {  
      alert("Please upload a valid Excel file!");  
  }  
}  

function BindTable(jsondata, tableid) {/*Function used to convert the JSON array to Html Table*/  
  var columns = BindTableHeader(jsondata, tableid); /*Gets all the column headings of Excel*/  
  for (var i = 0; i < jsondata.length; i++) {  
      var row$ = $('<tr/>');  
      for (var colIndex = 0; colIndex < columns.length; colIndex++) {  
          var cellValue = jsondata[i][columns[colIndex]];  
          if (cellValue == null)  
              cellValue = "";  
          row$.append($('<td/>').html(cellValue));  
      }  
      $(tableid).append(row$);  
  }  
}  
function BindTableHeader(jsondata, tableid) {/*Function used to get all column names from JSON and bind the html table header*/  
  var columnSet = [];  
  var headerTr$ = $('<tr/>');  
  for (var i = 0; i < jsondata.length; i++) {  
      var rowHash = jsondata[i];  
      for (var key in rowHash) {  
          if (rowHash.hasOwnProperty(key)) {  
              if ($.inArray(key, columnSet) == -1) {/*Adding each unique column names to a variable array*/  
                  columnSet.push(key);  
                  headerTr$.append($('<th/>').html(key));  
              }  
          }  
      }  
  }  
  $(tableid).append(headerTr$);  
  return columnSet;  
}  

</script>

